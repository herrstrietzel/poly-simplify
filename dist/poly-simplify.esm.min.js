function t(t,e){return(e.x-t.x)**2+(e.y-t.y)**2}function e(t,e=48){if(!Array.isArray(t)||t.length<=e)return t;let n=t.length,r=n/e,a=[];for(let n=0;n<e;n++)a.push(t[Math.floor(n*r)]);let l=a.length;return a[l-1]!==t[n-1]&&(a[l-1]=t[n-1]),a}function n(t,e=!1){let n=0;for(let e=0,r=t.length;r&&e<r;e++){n+=t[e].x*t[e===t.length-1?0:e+1].y*.5-t[e===t.length-1?0:e+1].x*t[e].y*.5}return e?Math.abs(n):n}function r(r,{tolerance:o=.5,useRDP:i=!0,decimals:u=-1,maxVertices:y=1/0,useMax:s=!1,output:x="points",meta:h=!1}={}){let p=[];const f=(t,e="points",r,a=!1)=>{let l=t.length,o=a?n(r,!0):0,i=a?n(t,!0):0,u=a?+(100/i*Math.abs(o-i)).toFixed(3):0;if("pointstring"!==e&&"string"!==e||(t=t.map((t=>`${t.x} ${t.y}`)).join(" ")),"path"!==e&&"d"!==e||(t="M"+t.map((t=>`${t.x} ${t.y}`)).join(" ")),"pathData"===e||"pathdata"===e){let e=[{type:"M",values:[t[0].x,t[0].y]},...t.slice(1).map((t=>({type:"L",values:[t.x,t.y]})))];t=e}return"json"===e.toLowerCase()&&(t=JSON.stringify(t)),{data:t,count:l,original:r.length,areaOriginal:o,areaptsSmp:i,areaDiff:u}};let c=f(r=function(t){let e=t[0].x||!1,n=e&&"object"==typeof t[0]?t[0].constructor.name?t[0].constructor.name:"object":null;if(e&&"object"!==n&&(t=[...t].map((t=>({x:t.x,y:t.y})))),e)return t;let r="string"==typeof t;if(r&&t.startsWith('[{"x":'))return JSON.parse(t);if(r&&(t=t.trim().split(/,| /).filter(Boolean).map(Number)).filter((t=>isNaN(t))).length)return console.warn("input doesn't contain point data â€“ please, check your input structure for syntax errors"),[];return Array.isArray(t)&&2===t[0].length&&(t=t.map((t=>({x:t[0],y:t[1]})))),!Array.isArray(t[0])&&!t[0].hasOwnProperty("x")&&(t=(t=>{let e=[];for(let n=1,r=t.length;n<r;n+=2)e.push({x:t[n-1],y:t[n]});return e})(t)),t}(r),x,r,h);if(r.length<=2||0===o)return h?c:c.data;if(s&&y<1/0)return p=e(r,y),c=f(p,x,r,h),c;p=a(r);let g=function(e){let n=t(e[0],e[1]);for(let r=3,a=e.length;r<a;r++){let a=t(e[r-1],e[r]);if(100/n*Math.abs(n-a)>.1)return!1;n=a}return!0}(p);return g&&(i=!1),i&&(p=l(p,o)),u>-1&&(p=p.map((t=>({x:+t.x.toFixed(u),y:+t.y.toFixed(u)})))),c=f(p,x,r,h),console.log("data",c),h?c:c.data}function a(e){let r=e[0],a=[r];for(let l=2,o=e.length;l<o;l++){let o=e[l-1],i=e[l],u=0;if(r.x===o.x&&r.y!==o.y||r.x!==o.x&&r.y===o.y)i.x===o.x&&i.y!==o.y||i.x!==o.x&&i.y===o.y||a.push(o),r=o;else{if(!(r.x===o.x&&r.y===o.y||r.x===o.x&&r.y!==o.y||r.x!==o.x&&r.y===o.y)){u=t(o,i);let e=n([r,o,i],!0);!e||(!u||e<.01*u)||a.push(o)}r=o}}return a}function l(t,n=.5){if(t.length<=2)return t;let r=e(t,32),{width:a,height:l}=function(t){let e=t.map((t=>t.x)),n=t.map((t=>t.y)),r=Math.min(...e),a=Math.max(...e),l=Math.min(...n),o=Math.max(...n);return{x:r,left:r,right:a,y:l,top:l,bottom:o,width:a-r,height:o-l}}(r),o=5e4/Math.max(a,l)**2;n/=o,console.log("scale",o,n);const i=(t,e,n)=>{let r=e.x,a=e.y,l=n.x-r,o=n.y-a;if(0!==l||0!==o){let e=((t.x-r)*l+(t.y-a)*o)/(l*l+o*o);e>1?(r=n.x,a=n.y):e>0&&(r+=l*e,a+=o*e)}return(t.x-r)**2+(t.y-a)**2};let u=[t[0]],y=[];for(y.push([0,t.length-1]);y.length>0;){let[e,r]=y.pop(),a=n,l=-1;for(let n=e+1;n<r;n++){let o=i(t[n],t[e],t[r]);o>a&&(l=n,a=o)}a>n?(y.push([l,r]),y.push([e,l])):u.push(t[r])}return u}"undefined"!=typeof window&&(window.polySimplify=r);export{r as polySimplify,a as simplifyPolyLossless,l as simplifyPolyRDP};
