function e(e){return function(e){let t=[{type:"M",values:e[0].values}],a=t[0];for(let l=1,r=e.length;l<r;l++){let r=e[l],{type:n,values:s}=r,u=s.length,i=a.values,o=i.length,[p,h]=[s[u-2],s[u-1]],[y,c]=[i[o-2],i[o-1]];switch(n){case"H":a={type:"L",values:[s[0],c]};break;case"V":a={type:"L",values:[y,s[0]]};break;case"z":case"Z":a={type:"Z",values:[]};break;case"M":a={type:"M",values:[s[0],s[1]]};break;default:a={type:"L",values:[p,h]}}t.push(a)}return t}(a(function(e,t=!0){const a={77:2,109:2,65:7,97:7,67:6,99:6,72:1,104:1,76:2,108:2,81:4,113:4,83:4,115:4,84:2,116:2,86:1,118:1,90:0,122:0};let l=new Set([...Object.keys(a).map(Number)]);const r=new Set([5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279]);function n(e){return 10===e||13===e||8232===e||8233===e||44===e||32===e||9===e||11===e||12===e||160===e||e>=5760&&r.has(e)>=0}function s(e){return l.has(e)}let u,i=0,o=e.length,p="",h=[],y=-1,c="",f=!1,g=!1,x=0,m=0,v=0,d=!1,M=[];const b=()=>{d&&("M"===p?p="L":"m"===p&&(p="l"),h.push({type:p,values:[]}),y++,m=0,d=!1)},w=(e=!1)=>{(e?x>0:""!==c)&&(t&&-1===y&&(u="Pathdata must start with M command",M.push(u),p="M",h.push({type:p,values:[]}),v=2,m=0,y++),"A"===p||"a"===p?(c=A(),h[y].values.push(...c)):(t&&c[1]&&"."!==c[1]&&"0"===c[0]&&(u="Leading zeros not valid: "+c,M.push(u)),h[y].values.push(+c)),m++,c="",x=0,d=m>=v)},A=()=>{let e=c.length,t=!1;return 3===m&&2===e||4===m&&e>1?(c=[+c[0],+c[1]],t=!0,m++):3===m&&e>=3&&(c=[+c[0],+c[1],+c.substring(2)],t=!0,m+=2),t?c:[+c]},$=()=>{if(t){let e=y>0?h[y]:0,t=e?e.values.length:0;(t&&t<v||t&&t>v||("z"===p||"Z"===p)&&t>0)&&(u=`Pathdata commands in "${p}" (segment index: ${y}) don't match allowed number of values: ${v-t}/${v}`,M.push(u))}};for(;i<o;){let t=e[i],l=e.charCodeAt(i);if(s(l)){""!==c&&(h[y].values.push(+c),m++,c=""),$(),p=t,v=a[l];let e="M"===p||"m"===p;y>0&&("z"===h[y].type||"Z"===h[y].type)&&!e&&(h.push({type:"m",values:[0,0]}),y++),h.push({type:p,values:[]}),y++,g=!1,x=0,m=0,d=!1,i++}else if(n(l))w(),g=!0,f=!1,i++;else{if(i===o-1){c+=t,w(),g=!1,f=!1,$();break}if(!f&&!g&&45===l||!f&&46===l){let e=46===l;w(e),b(),e&&x++}else b();c+=t,f=69===l||101===l,g=!1,i++}}if($(),h[0].type="M",t&&M.length){if(u="Invalid path data:\n"+M.join("\n"),"log"!==t)throw new Error(u);console.warn(u)}return h}(e),!1))}function t(e){let t=[{x:e[0].values[0],y:e[0].values[1]}];for(let a=1,l=e.length;a<l;a++){let{values:l}=e[a];if(l.length){let e=l.slice(-2);t.push({x:e[0],y:e[1]})}}return t}function a(e,t=!1){let a=e[0].values,l=a[0],r=a[1],n=l,s=r;for(let a=1,u=e.length;a<u;a++){let u=e[a],{type:i,values:o}=u,p=t?i.toLowerCase():i.toUpperCase();if(i!==p)switch(i=p,u.type=i,i){case"a":case"A":o[5]=t?o[5]-l:o[5]+l,o[6]=t?o[6]-r:o[6]+r;break;case"v":case"V":o[0]=t?o[0]-r:o[0]+r;break;case"h":case"H":o[0]=t?o[0]-l:o[0]+l;break;case"m":case"M":t?(o[0]-=l,o[1]-=r):(o[0]+=l,o[1]+=r),n=t?o[0]+l:o[0],s=t?o[1]+r:o[1];break;default:if(o.length)for(let e=0;e<o.length;e++)o[e]=t?o[e]-(e%2?r:l):o[e]+(e%2?r:l)}let h=o.length;switch(i){case"z":case"Z":l=n,r=s;break;case"h":case"H":l=t?l+o[0]:o[0];break;case"v":case"V":r=t?r+o[0]:o[0];break;case"m":case"M":n=o[h-2]+(t?l:0),s=o[h-1]+(t?r:0);default:l=o[h-2]+(t?l:0),r=o[h-1]+(t?r:0)}}return e[0].type="M",e}function l(e,t=-1,l=!1,r=!1){return r&&(e=function(e){let t,a=[{type:"M",values:e[0].values}],l=a[0],r={x:e[0].values[0],y:e[0].values[1]},n=.01;for(let s=1,u=e.length;s<u;s++){let u=e[s],{type:i,values:o}=u,p=o.length?o.slice(-2):[];t={x:p[0],y:p[1]};let h=Math.abs(t.x-r.x),y=Math.abs(t.y-r.y),c=(h+y)/2*n;switch(i){case"L":l=0===y||y<c&&h>c?{type:"H",values:[o[0]]}:0===h||y>c&&h<c?{type:"V",values:[o[1]]}:u;break;case"M":case"Z":case"z":l={type:i,values:p};break;default:l={type:"L",values:p}}r={x:p[0],y:p[1]},a.push(l)}return a}(e)),l&&(e=function(e){return a(e,!0)}(e)),t>-1&&(e=e.map((e=>({type:e.type,values:e.values.map((e=>+e.toFixed(t)))})))),e}function r(e,t=1){let a=t>1,l=!a;"l"===(e=JSON.parse(JSON.stringify(e)))[1].type&&l&&(e[0].type="m");let r="";r=a?`${e[0].type} ${e[0].values.join(" ")}\n`:`${e[0].type}${e[0].values.join(" ")}`;for(let t=1,n=e.length;t<n;t++){let n=e[t-1],s=e[t],{type:u,values:i}=s;if(!l||"A"!==u&&"a"!==u||(i=[i[0],i[1],i[2],`${i[3]}${i[4]}${i[5]}`,i[6]]),u=n.type===s.type&&"m"!==s.type.toLowerCase()&&l||("m"===n.type&&"l"===s.type||"M"===n.type&&"l"===s.type||"M"===n.type&&"L"===s.type)&&l?" ":s.type,l){let e="",t=!1;for(let a=0,l=i.length;a<l;a++){let l=i[a],r=l.toString(),n=r.includes(".")&&Math.abs(l)<1;n&&t&&(r=r.replace(/^0\./,".")),!(a>0)||t&&n||(e+=" "),e+=r,t=n}r+=`${u}${e}`}else r+=a?`${u} ${i.join(" ")}\n`:`${u}${i.join(" ")}`}return l&&(r=r.replace(/ 0\./g," .").replace(/ -/g,"-").replace(/-0\./g,"-.").replace(/Z/g,"z")),r}function n(a){if(!a||!a.length)return[];let l=a[0].x||!1;if(l&&a.length>0&&"object"==typeof a[0]&&a[0].constructor!==Object&&(e=>{let t=e.length,a=new Array(t);for(let l=0;l<t;l++)a[l]={x:e[l].x,y:e[l].y}})(a),l)return a;let r="string"==typeof a,n=!1;if(!!r&&(a.startsWith("M")||a.startsWith("m"))){0;let l=e(a),r=function(e){let t=[];try{e.map(((e,t)=>"m"===e.type.toLowerCase()?t:-1)).filter((e=>-1!==e))}catch{console.log("catch",e)}let a=e.map(((e,t)=>"m"===e.type.toLowerCase()?t:-1)).filter((e=>-1!==e));return 1===a.length?[e]:(a.forEach(((l,r)=>{t.push(e.slice(l,a[r+1]))})),t)}(l);n=r.length>1;let s=[];return n?r.forEach((e=>{let a=t(e);s.push(a)})):s=t(l),s}if(!!r&&(a.startsWith("{")||a.startsWith("["))&&(a=JSON.parse(a),r=!1),r){if((a=a.trim().split(/,| /).filter(Boolean).map(Number)).filter((e=>isNaN(e))).length)return console.warn("input doesn't contain point data â€“ please, check your input structure for syntax errors"),[]}return Array.isArray(a)&&2===a[0].length&&(a=a.map((e=>({x:e[0],y:e[1]})))),!Array.isArray(a[0])&&!a[0].hasOwnProperty("x")&&(a=(e=>{let t=[];for(let a=1,l=e.length;a<l;a+=2)t.push({x:e[a-1],y:e[a]});return t})(a)),a}function s(e,t){return(t.x-e.x)**2+(t.y-e.y)**2}function u(e){let t=s(e[0],e[1]);for(let a=3,l=e.length;a<l;a++){let l=s(e[a-1],e[a]);if(100/t*Math.abs(t-l)>.1)return!1;t=l}return!0}function i(e,t=48){if(!Array.isArray(e)||e.length<=t)return e;let a=e.length,l=a/t,r=[];for(let a=0;a<t;a++)r.push(e[Math.floor(a*l)]);let n=r.length;return r[n-1]!==e[a-1]&&(r[n-1]=e[a-1]),r}function o(e,t=!1){let a=0;for(let t=0,l=e.length;l&&t<l;t++){a+=e[t].x*e[t===e.length-1?0:t+1].y*.5-e[t===e.length-1?0:t+1].x*e[t].y*.5}return t?Math.abs(a):a}function p(e){let t=e.map((e=>e.x)),a=e.map((e=>e.y)),l=Math.min(...t),r=Math.max(...t),n=Math.min(...a),s=Math.max(...a);return{x:l,left:l,right:r,y:n,top:n,bottom:s,width:r-l,height:s-n}}function h(e,t,a="points",n=!1,u=-1,h=!1,y=!1,c=!1,f=1,g=0,x=0,m=!1,v=0,d=0){let M={data:[],ptsArr:[],countOriginal:0,count:0,areaOriginal:0,areaptsSmp:0,areaDiff:0,isPolygon:[]};t=function(e,t=1,a=0,l=0,r=!1,n=0,s=0){if(1===t&&0===n&&0===s&&0===a&&0===l&&!1===r)return e;let u,i,o,h,y=Array.isArray(e[0]),c=y?e:[e],f=y?e.flat():e;return({x:u,y:i,width:o,height:h}=p(f)),c.forEach(((e,p)=>{t=n?n/o:s?s/h:t,s&&h*t>s&&(t=s/h),r&&(a=-u,l=-i);for(let r=0,n=e.length;r<n;r++){let n=e[r];c[p][r]={x:(n.x+a)*t,y:(n.y+l)*t}}})),c}(t,f,g,x,m,v,d);for(let a=0,l=t.length;a<l;a++){let l=e[a],r=t[a],u=l.length;M.countOriginal+=u;let h=r.length;M.count+=h,M.ptsArr.push(r);let y=!1;if(n){let e=o(l,!0),t=o(r,!0);M.areaOriginal=e,M.areaptsSmp=t;let a=i(l,32),{width:u,height:h}=p(a),c=(Math.max(u,h)/l.length)**2;y=s(l[0],l[l.length-1])<c,M.isPolygon.push(y);let f=n?+(100/t*Math.abs(e-t)).toFixed(3):0;M.areaDiff+=f}}switch(a=a.toLowerCase()){case"points":case"pointstring":case"pointsnested":case"json":M.ptsArr=M.ptsArr.map((e=>e.map((e=>({x:+e.x.toFixed(u),y:+e.y.toFixed(u)}))))),"pointstring"===a?M.data=M.ptsArr.map((e=>e.map((e=>`${e.x} ${e.y}`)).join(" "))):"points"===a?M.data=M.ptsArr:"pointsnested"===a?M.data=M.ptsArr.map((e=>e.map((e=>[e.x,e.y])))):"json"===a&&(M.data=JSON.stringify(M.ptsArr));break;case"pathdata":case"path":let e=[];M.ptsArr.forEach(((t,a)=>{let l=[{type:"M",values:[t[0].x,t[0].y]},...t.slice(1).map((e=>({type:"L",values:[e.x,e.y]})))];M.isPolygon[a]&&l.push({type:"Z",values:[]}),e.push(...l)})),e=l(e,u,h,y),M.data="path"===a?[r(e,c?1:0)]:e}return M}function y(e,{tolerance:t=.1,removeColinear:a=!0,useRDP:l=!0,detectRegular:r=!1,decimals:s=-1,maxVertices:o=1/0,toMaxVertices:p=!1,outputFormat:y="points",scale:g=1,alignToZero:x=!1,translateX:m=0,translateY:v=0,scaleToWidth:d=0,scaleToHeight:M=0,meta:b=!1,toRelative:w=!1,toShorthands:A=!1,minifyString:$=!1}={}){let k=(e=n(e))[0].length>1,L=k?e:[e],S=[];for(let e=0,n=L.length;e<n;e++){let n=L[e],s=!1;if(!n.length)return[];let h=n;n.length<=2||0===t?S.push(h):p&&o<1/0?(h=i(n,o),S.push(h)):(h=a?c(h,k):h,r&&(s=u(h),s&&(l=!1)),l&&(h=f(h,t,k)),S.push(h))}let j=h(L,S,y,b,s,w,A,$,g,m,v,x,d,M);return b?j:j.data}function c(e,t=!1){let a=e[0],l=[a];for(let t=2,r=e.length;t<r;t++){let n=e[t-1],u=e[t],i=0;if(a.x===n.x&&a.y!==n.y||a.x!==n.x&&a.y===n.y)u.x===n.x&&u.y!==n.y||u.x!==n.x&&u.y===n.y||l.push(n),a=n;else{if(!(a.x===n.x&&a.y===n.y||a.x===n.x&&a.y!==n.y||a.x!==n.x&&a.y===n.y)){i=s(n,u);let e=o([a,n,u],!0);!e||(!i||e<.01*i)||l.push(n)}a=n,t===r-1&&l.push(e[e.length-1])}}return l}function f(e,t=.1,a=!1){if(e.length<=2)return e;let l=i(e,32),{width:r,height:n}=p(l),s=Math.max(r,n);t/=s<=10?1e5/s:1;const u=(e,t,a)=>{let l=t.x,r=t.y,n=a.x-l,s=a.y-r;if(0!==n||0!==s){let t=((e.x-l)*n+(e.y-r)*s)/(n*n+s*s);t>1?(l=a.x,r=a.y):t>0&&(l+=n*t,r+=s*t)}return(e.x-l)**2+(e.y-r)**2};let o=[e[0]],h=[];for(h.push([0,e.length-1]);h.length>0;){let[a,l]=h.pop(),r=t,n=-1;for(let t=a+1;t<l;t++){let s=u(e[t],e[a],e[l]);s>r&&(n=t,r=s)}r>t?(h.push([n,l]),h.push([a,n])):o.push(e[l])}return o}"undefined"!=typeof window&&(window.polySimplify=y);export{l as minifyPathData,n as normalizePointInput,r as pathDataToD,y as polySimplify,f as simplifyPolyRDP,c as simplifyRemoveColinear};
